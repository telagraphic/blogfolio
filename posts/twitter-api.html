---
title: Twitter API
layout: page
permalink: /twitter-api
---

<article class="post">

  <section class="post__header">
    <h2>Twitter API: Get Timeline Tweets From Multiple Tweeters</h2>
    <time>8/2020</time>
  </section>

  <section class="post__banner">
    <img src="{{site.baseurl}}assets/img/posts/browser-sync-logo.png" alt="Express & Browser-Sync"></img>
  </section>

  <section class="post__article">

    <p>
      In this post I'll cover using the <a href="https://github.com/draftbit/twitter-lite">twitter-lite</a> package to loop through an array of twitter users
      and fetch their tweets. You'll need a twitter developer account and app to get your set of
      keys to access the <a href="https://developer.twitter.com/en/docs">twitter api</a>. This might take a day or two for them
      to verify your application, I suggest selecting the "Exploring The API" or "Student" options.
    </p>

    <p>
      It will help to be aware of <b>async/await</b> and promises since they are very useful for making asynchronous actions like
      network api calls, querying database and reading/writing to files. If you are unfamiliar with <b>async/await</b> then this
      is a great way to learn and see a practical use case of it in action. I sure learned about it putting the <a href="http://www.frontendtweets.com/">app together</a> that this
      example is based on.
    </p>

    <button>
      <a href="{{site.baseurl}}assets/files/twitter-api.zip" download>DOWNLOAD</a> the full example with code and audio files to follow along.
    </button>

    <h3>Twitter API</h3>

    <p>
      The Twitter API has many endpoints for getting all kinds of data, we'll be focusing on the <a href="https://developer.twitter.com/en/docs/tweets/timelines/overview">statuses/user_timeline</a>
      to get a set of recent tweets by providing a <b>user_name</b> or <b>user_id</b>. This will allow us to get other users' tweets which is kinda of creepy if you think about it.
      Luckily we'll be retrieving user's who are leaders and mover and shakers in the front end development community, so they're should be a lot of cool stuff
      relevant to what we are doing in this tutorial.
    </p>

    <p>
      The order of code operations will be this: <b>1)</b> read a file of twitter users, <b>2)</b> loop through these users and call a function to fetch their tweets,
      <b>3)</b> aggregate all those tweets into one array, <b>4>)</b> do something like save to a database, file or just display somewhere.
    </p>

    <p>
      But first, you'll need your twitter app's keys and tokens which you can find in your developer account dashboard.
      We'll need to initialize our twitter API object with the required authentication credentials. I'm saving mine in
      environment variables, but you can easily replace them with the raw string.
    </p>
  </section>


  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        const Twitter = require('twitter-lite');

        const twitter = new Twitter({
          subdomain: "api",
          consumer_key: process.env.CONSUMER_KEY, // from Twitter.
          consumer_secret: process.env.CONSUMER_SECRET, // from Twitter.
          access_token_key: process.env.ACCESS_TOKEN_KEY, // from your User (oauth_token)
          access_token_secret: process.env.ACCESS_TOKEN_SECRET // from your User (oauth_token_secret)
        });
      </code>
    </pre>
  </section>

  <section class="post__article">
    <p>
      I have collected a small list of front end tweeters for us to query against. I have stored these in a <b>json</b> file.
      When we call the twitter api endpoint at <a href="https://developer.twitter.com/en/docs/tweets/timelines/api-reference/get-statuses-user_timeline">statuses/user_timline</a>,
      we'll get a response with a bunch of fields. Take a look at the link to see.
    </p>
  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        [{
            "handle": "BrendanEich",
          },
          {
            "handle": "dan_abramov",
          },
          {
            "handle": "rachsmithtweets",
          },
          {
            "handle": "addyosmani",
          },
          {
            "handle": "sindresorhus",
          },
          {
            "handle": "sarah_edo",
          },
          {
            "handle": "wesbos",
          },
          {
            "handle": "NNgroup",
          },
          {
            "handle": "joulee",
          },
          {
            "handle": "JAF_Designer",
          },
          {
            "handle": "rjs",
          },
          {
            "handle": "xeeliz",
          },
          {
            "handle": "alyssaxuu",
          }
        ]
      </code>
    </pre>
  </section>

  <section class="post__article">
    <p>
      Our first function will read this json file and parse the JSON for another function.
      We are wrapping this in a promise and then putting the <b>async</b> keyword in front the
      <b>getTweeters()</b> function to tell our code that this function returns a promise.

      Check out <a href="https://javascript.info/async-await">javascript.info</a> for some great examples of
      how to use async/await. The reason we are using promises is to make our code asynchronous in order to
      handle tasks that take an uncertain amount of time to complete, hence it's called a promise for something
      in the future to occur.
    </p>

    <p>
      The third line uses Node's file system library to <b>readFile</b> which is our <b>tweeters.json</b>.
      The <b>.</b> in the file path says to look in the current directory, unlike a double <b>..</b> which says to move
      up a directory. We use the promise callback keyword <b>resolve</b> to return our parsed json contents from the file.
      The <b>reject</b> callback will return the error.
    </p>
  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        async function getTweeters() {
          return new Promise((resolve, reject) => {
            fs.readFile('./tweeters.json', (err, data) => {
              if (err) reject(err);
              else resolve(JSON.parse(data));
            });
          });
        };
      </code>
    </pre>
  </section>

  <section class="post__article">
    <p>
      The next function loopa through the array of user objects from our file,
      and calls another function <b>getUserProfiles()</b> which actually makes the twitter api call.
      This was a crucial learning lesson for me on looping with <b>async/await</b>.
      You'll notice we are using a <b>for</b> loop and not something like <b>forEach</b> on our <b>users</b> array.
      <a href="https://zellwk.com/blog/async-await-in-loops#await-in-a-foreach-loop">Zell Liew</a>explains that <b>forEach</b> is not promise aware.
      Thus we have to use a <b>for</b> loop and it works just fine but definitely a subtle detailed gotcha to know.
    </p>

    <p>
      The function ends with a deep flattening of all the tweets so that they are on the same level of the array and not nested.
    </p>

  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        async function getProfiles(users) {

          let allTweeterProfiles = [];

          for (let index = 0; index < users.length; index++) {
            let tweeterProfiles = await getUserProfiles(users[index]);
            allTweeterProfiles.push(tweeterProfiles);
          }

          return flattenDeep(allTweeterProfiles);
        };
      </code>
    </pre>
  </section>

  <section class="post__article">
    <h3>Getting the Tweets</h3>
    <p>
      We are finally using the <b>twitter</b> object we created at the top of the file and calling the <b>get</b>
      method and passing in the <b>statuses/user_timeline</b> endpoint along with the <b>user.handle</b> and a
      the number of tweets we would like to return. Once again, we are wrapping this code with a <b>promise</b>
      and <b>resolving</b> the <b>userTweets</b> or <b>rejecting</b> with the error. Take some time to
      read each line of code in the function, there is a lot of good stuff happening.
    </p>

    <p>
      The <b>if</b> state checks to make sure the tweet is not a retweet of someone else's tweet, we only
      want original tweets from the user.
      It would help to see the
      <a href="https://developer.twitter.com/en/docs/tweets/timelines/api-reference/get-statuses-user_timeline">data structure returned from twitter for a single tweet</a>.
      After we get the data, we loop through it and save it to an object that will be added to the <b>userTweets</b> array.
    </p>
  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        async function getUserTweets(user) {

          return new Promise((resolve, reject) => {
            let userTweets = [];

            twitter
              .get("statuses/user_timeline", {screen_name: user.handle, count: 3})
              .then(data => {

                data.forEach(function(tweet) {

                  if (!tweet.retweeted_status) {

                    userTweets.push({
                      "twittertime": utilities.twitterDate(tweet.created_at),
                      "created": new Date(tweet.created_at),
                      "handle": tweet.user.screen_name,
                      "message": tweet.text,
                      "site": tweet.user.url || '',
                      "topic": user.topic,
                      "hashtags": [...tweet.entities.hashtags],
                      "link": `https://www.twitter.com/${tweet.user.screen_name}/status/${tweet.id_str}`,
                      "id_string": tweet.id_str
                    });
                  }

                });

                resolve(userTweets);

              })
              .catch(error => {
                reject(error);
              });
          });
        };
      </code>
    </pre>
  </section>


  <section class="post__article">
    <h3>A Helpful Tool</h3>
    <p>
      <a href="https://httptoolkit.tech/">HTTP Toolkit</a> was posted on hackernews one day and I found it to be useful
      for api debugging and testing. I simply selected a terminal session, it opened up a terminal window and I navigated to
      my app directory, ran the node script and you'll get the HTTP response from the Twitter API. Very helpful!
    </p>

    <figure class="post__figure-video">
      <video autoplay loop muted playsinline>
        <source src="{{site.baseurl}}assets/img/posts/http-toolkit-clip.webm" type="video/webm">
        <source src="{{site.baseurl}}assets/img/posts/http-toolkit-clip.mp4" type="video/mp4">
      </video>
      <figcaption>
        <h5>
          Firefox Flexbox Inspector Console
        </h5>
      </figcaption>
    </figure>



  </section>

  <section class="post__article">
    <h3>Saving the Tweets</h3>
    <p>
      Finally, we'll save the tweets to a file. This would be the place to save to a database as well.
    </p>

  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        async function saveTweets(tweets) {
          fs.writeFileSync(`./tweets.json`, JSON.stringify(tweets));
        };
      </code>
    </pre>
  </section>

  <section class="post__article">
    <h3>Putting It Together</h3>
    <p>
      At last, we call all of our functions but instead of using promises to write code like below.
    </p>

  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        getTweeters()
          .then(getTweets)
          .then(saveTweets)
      </code>
    </pre>
  </section>

  <section class="post__article">
    <p>
      We can write the code that reads like synchronous code with <b>async/await</b>.
      It definitly makes it easier to read!
    </p>

  </section>

  <section class="post__code-snippet">
    <pre>
      <code class="language-js">
        async function getAllTweets() {
          let tweeters = await getTweeters();
          let tweets = await getTweets(tweeters);
          await saveTweets(tweets);
        }

        getAllTweets();
      </code>
    </pre>
  </section>

  <section class="post__article">
    <p>
      This post was based on <a href="http://www.frontendtweets.com/">Front End Tweets</a>, a project that fetches
      tweets from popular UI/UX/Front Ender's.
    </p>

  </section>

</article>